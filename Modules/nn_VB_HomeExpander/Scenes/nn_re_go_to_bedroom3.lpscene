WHAT: none
WHERE: none
WHEN: 0 - 24
WHO: none
OTHER: none

    /////////////////////////////////////////////////////////////////
    // This is basically the same as nn_re_go_to_bedroom2.lpscene
    // Differences:
    // - RE_has_thirdbedroom
    // - Tenants are swapped
    // - followUp is nn_he_random_bedroom3_encounter
    // - background is 2x re_bedroom3.lpworld
    
    If !isAtHome() && PlayerHasHome()
        moveTo(home)
    EndIf
    
    If !PlayerHasHome()
        SceneStart()
        "You need to find a personal home first!"
        SceneEnd()
    Else
        clearGetList()  // sometimes the getGlobal/getSpecific calls do not work without this call
        hasRoom = RE_has_thirdbedroom.getGlobal()
        
        // Move to the room
        If hasRoom > 0
            // get main tenant
            secTenantID = RE_second_Tenant.getGlobal()
            thirdTenantID = RE_third_Tenant.getGlobal()
            Tenant = getSpecific(thirdTenantID) 
            TenantB = getSpecific(secTenantID) 
            If TenantB.isValid()
                TenantB.hide()
            EndIf            
            
            If !Tenant.isValid()
                // Just show the room
                setBackground3D(Modules/nn_VB_HomeExpander/Rooms/re_bedroom3.lpworld)
            Else
                // Get tenant kinks
                tenantClothingStyle = Tenant.getActorVar(RE_home_clothing)
                tenantNoDoorLocking = Tenant.getActorVar(RE_dont_lock_doors)
                
                chance = Random(0,10)
                
                // Decide if the room is open
                // Dates leave the room open
                If tenantNoDoorLocking == 0 && !Tenant.isDating() && chance <= 3   && [WHEN<=10 || WHEN>=16]
                    // Room locked
                    Tenant.saveAndDelete()
                    If TenantB.isValid()
                        TenantB.saveAndDelete()
                    EndIf
                    
                    SceneStart()
                    followUp(nn_he_random_bedroom3_encounter)
                    SceneEnd()
                Else
                    setBackground3D(Modules/nn_VB_HomeExpander/Rooms/re_bedroom3.lpworld)
                    
                    // TODO: Decide if tenant is in its room
                    If chance>=1 && [WHEN<=10 || WHEN>=16]
                        If tenantClothingStyle == 2
                            Tenant.strip()
                        ElseIf tenantClothingStyle == 1
                            If Tenant.isMale()
                                Tenant.dressExcept(Outerwear, Top, Bottom, Foot, Headwear)
                            Else
                                // dressExcept produces ugly results for girls in version 3.17 at least
                                Random
                                    TenantA.dress(Floral-Fiesta-Panty_1_F, Hot-Work-Bra_1_F)
                                    TenantA.dress(You-Wanna-Play-Panty_1_F, Basic-Lingerie-Bra_1_F)
                                    TenantA.dress(Angel-Secrets-Wool-Panties_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantA.dress(Bella-Chic-Jacket_1_F, Bella-Chic-Bra_1_F)
                                    TenantA.dress(Burlesque-Bustier_1_F, Burlesque-Bra_1_F)
                                    TenantA.dress(Bikinis-Bottom_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantA.dress(Flounce-Bikini-Bottom_1_F, Flounce-Bikini-Top_1_F)
                                    TenantA.dress(Basic-Panty_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantA.dress(FGHM-Panty_1_F, Cathy-Jo-Fashion-Bra_1_F)
                                    TenantA.dress(FG-Panty_1_F, Jumpsuit-Halter-Bra_1_F)
                                    TenantA.dress(Trident-Bikini-Bottom_1_F, Bikinis-Top_1_F)
                                    TenantA.dress(Hongyu-Pantie_1_F, Basic-Bra_1_F)
                                    TenantA.dress(Passion-Touch-Lingerie-Shorts_1_F, Passion-Touch-Lingerie-Top_1_F)
                                    TenantA.dress(Pure-Chance-Panties_1_F, Oot-Shade-Lingerie-Bra_1_F)
                                    TenantA.dress(Nf-Panty_1_F, Powerage-Bra_1_F)
                                EndRandom
                            EndIf
                        Else
                            If Tenant.isNaked()
                                Tenant.dress()
                            EndIf
                        EndIf
                        Tenant.setNoRedress(true)
                        Tenant.addToPeopleHere()
                    Else
                        Tenant.hide()
                        Tenant.saveAndDelete()
                        Tenant = 0
                    EndIf
                    
                    // Randomly both tenants are in the room, otherwise one
                    // TODO: Add something like rapport to other tenant
                    tenantBClothingStyle = TenantB.getActorVar(RE_home_clothing)
                    
                    chance = Random(0,10)
                    If !Tenant.isValid() || chance > 3 || WHEN >= 23 || WHEN <= 6
                        // get rid of the actor
                        TenantB.hide()
                        TenantB.saveAndDelete()
                    Else
                        If TenantBClothingStyle == 2
                            TenantB.strip()
                        ElseIf TenantBClothingStyle == 1
                            If TenantB.isMale()
                                TenantB.dressExcept(Outerwear, Top, Bottom, Foot, Headwear)
                            Else
                                // dressExcept produces ugly results for girls in version 3.17 at least
                                Random
                                    TenantB.dress(Floral-Fiesta-Panty_1_F, Hot-Work-Bra_1_F)
                                    TenantB.dress(You-Wanna-Play-Panty_1_F, Basic-Lingerie-Bra_1_F)
                                    TenantB.dress(Angel-Secrets-Wool-Panties_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantB.dress(Bella-Chic-Jacket_1_F, Bella-Chic-Bra_1_F)
                                    TenantB.dress(Burlesque-Bustier_1_F, Burlesque-Bra_1_F)
                                    TenantB.dress(Bikinis-Bottom_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantB.dress(Flounce-Bikini-Bottom_1_F, Flounce-Bikini-Top_1_F)
                                    TenantB.dress(Basic-Panty_1_F, Angel-Secrets-Brassiere_1_F)
                                    TenantB.dress(FGHM-Panty_1_F, Cathy-Jo-Fashion-Bra_1_F)
                                    TenantB.dress(FG-Panty_1_F, Jumpsuit-Halter-Bra_1_F)
                                    TenantB.dress(Trident-Bikini-Bottom_1_F, Bikinis-Top_1_F)
                                    TenantB.dress(Hongyu-Pantie_1_F, Basic-Bra_1_F)
                                    TenantB.dress(Passion-Touch-Lingerie-Shorts_1_F, Passion-Touch-Lingerie-Top_1_F)
                                    TenantB.dress(Pure-Chance-Panties_1_F, Oot-Shade-Lingerie-Bra_1_F)
                                    TenantB.dress(Nf-Panty_1_F, Powerage-Bra_1_F)
                                EndRandom
                            EndIf
                        Else
                            If TenantB.isNaked()
                                TenantB.dress()
                            EndIf
                        EndIf
                        TenantB.setNoRedress(true)
                        TenantB.addToPeopleHere()
                    EndIf
                    
                    If WHEN >= 23 || WHEN <= 6
                        Tenant.Animate(na_sleep)
                    EndIf
                   
                    Player.show(42,18,0)  // show up at the door
                    Player.animate()    // Don't do anything
                    cameraFocus(Tenant)
                EndIf
            EndIf   // Tenant.isValid()
        Else
            setBackground3D(Modules/nn_VB_HomeExpander/Rooms/re_empty.lpworld)
            Player.show(0,0,0)
            Player.animate()
            cameraFocus(Player)
        EndIf
        
        // If MC has animals show them randomly (usually they stick to the MC at home...)
        Actor = getCreature() 
        If Actor.isValid() && Actor.isCreatureType(Dog)
            chance = Random(0,6)
            If chance>=3
                Actor.show()
            Else
                Actor.hide()
            EndIf
        EndIf
    EndIf
    
    // eof