WHAT: none
WHERE: none
WHEN: 0 - 24
WHO: none
OTHER:

    secTenantID = RE_second_Tenant.getGlobal()
    thirdTenantID = RE_third_Tenant.getGlobal()
    
    // get main tenant
    Tenant = getSpecific(secTenantID) 
    
    // Randomly both tenants are in the room, otherwise one
    // TODO: Add something like rapport to other tenant
    TenantB = 0
    TenantB = getSpecific(thirdTenantID)
    chance = Random(0,10)
    If chance > 3  // 70%
        // get rid of the actor
        TenantB.hide()
        TenantB.saveAndDelete()
        TenantB = 0
    EndIf
    
    If Tenant.isValid()
        SceneStart()
            
        // Room may be locked
        sleeping = 0
        notInRoom = 0
        
        If WHEN > 22 || WHEN < 6
            // "NIGHT"
            
            // Tenant is asleep
            sleeping = 1
            
            // Also invalidate TenantB at night (sleeping)
            TenantB = 0
        ElseIf WHEN > 17 && WHEN <= 22
            // "EVENING"
        Else
            // Might be at work
            Work = Tenant.getBuilding(work) 
            If Work.isBuildingValid()
                Type = Work.getBuildingType()  //"work"
                
                If isOpen(type)
                    // Wokplaces are "open" longer than you usually work
                    // Read the AI controlled "work" pensum
                    
                    // TODO: Fixme! Does not work as of LP 3.17, work_today not filled
                    // Today = Tenant.getActorVar(work_today)
                    // If Today < 8
                    
                    // Silly work around...
                    If WHEN <= Random(14, 17)
                        // At work...
                        notInRoom = 1
                        
                        // Also invalidate TenantB
                        TenantB = 0
                    EndIf
                    // "DEBUG: Work_today = <Today>"
                Else
                    // "DEBUG: Not working."
                EndIf
            Else
                // "DEBUG: No workplace."
            EndIf
        EndIf
        
        viewMode = 0
        "The door is locked. You can't get in."
        
        // spy cam support
        hasCam = RE_has_spy_cam_second_room.getGlobal()
        If hasCam == 0
            "A spy cam could help you to see whats happening inside."
        EndIf
        
        1::"Peek through the keyhole"
        2::hasCam>0::"Check the camera"
        0::"Go back"
        
        If 1||2
            viewMode = choice
        EndIf
        
        If viewMode==0
            Tenant.hide()
            Tenant.saveAndDelete()
            If TenantB.isValid()
                TenantB.hide()
                TenantB.saveAndDelete()
            EndIf
            
            moveTo(home)
            // TODO: Rewrite as soon as we get  setBackgroundCustom(bedroom)
        Else
            // Move to the room
            setBackground3D(Modules/nn_HomeExpander/Rooms/re_bedroom2.lpworld)
            
            // TODO: Screen vignette or KeyHole effect
            If viewMode==1  // keyhole
                Player.hide()
            ElseIf viewMode==2  // camera
                Player.hide()
            Else
                Player.hide()
                Player.show(42,18,0)  // show up at the door
                Player.animate()
            EndIf
            
            // Show Tenant
            If notInRoom==0
                // Get tenant kinks
                TenantAClothingStyle = TenantA.getActorVar(RE_home_clothing)
                TenantBClothingStyle = TenantB.getActorVar(RE_home_clothing)
                
                chance = Random(0,5)
                If TenantAClothingStyle == 1 || chance <=2
                    // Show up in underwear
                    If Tenant.isMale()
                        Tenant.dressExcept(Outerwear, Top, Bottom, Foot, Headwear)
                    Else
                        // dressExcept produces ugly results for girls in version 3.17 at least
                        Random
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_1_F)
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_2_F)
                            Tenant.dress(Cool-Bra_1_F,Appealing-Panties_1_F)
                            Tenant.dress(Cool-Bra_1_F,Appealing-Panties_2_F)
                            Tenant.dress(Cool-Bra_1_F,Appealing-Panties_3_F)
                            Tenant.dress(Cool-Bra_1_F,Appealing-Panties_4_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_2_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_1_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_1_F,Stockings_2_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_2_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_2_F,Stockings_2_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_3_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_3_F,Stockings_2_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_4_F)
                            Tenant.dress(Cool-Bra_2_F,Appealing-Panties_4_F,Stockings_2_F)
                            Tenant.dress(Cool-Bra_3_F,Cool-Panties_1_F)
                            Tenant.dress(Cool-Bra_3_F,Cool-Panties_2_F)
                            Tenant.dress(Cool-Bra_3_F,Appealing-Panties_1_F)
                            Tenant.dress(Cool-Bra_3_F,Appealing-Panties_2_F)
                            Tenant.dress(Cool-Bra_3_F,Appealing-Panties_3_F)
                            Tenant.dress(Cool-Bra_3_F,Appealing-Panties_4_F)
                        EndRandom
                    EndIf
                Else TenantAClothingStyle == 2 
                    Tenant.strip()
                Else
                    If Tenant.isMale()
                        Tenant.dress()
                    Else
                        // Dress some nice private room clothing
                        Random
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_1_F,Cute-Croptop_1_F)
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_2_F,Cute-Croptop_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Croptop_2_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_2_F,Cute-Croptop_2_F)
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_1_F,Cute-Cami-Top_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Cami-Top_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Cami-Top_1_F,Cute-Leggings_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_2_F,Cute-Croptop_2_F,Cute-Leggings_1_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_1_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_2_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_3_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_1_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_2_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_3_F)
                            Tenant.dress(Sports-Bodysuit_1_F)
                            Tenant.dress(Sports-Slip_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_2_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_2_F,Nice-Camisole_1_F,Cute-Flare-Skirt_1_F)
                            Tenant.dress(Cool-Panties_1_F,Cute-Flare-TShirt_1_F,Cute-Flare-Skirt_1_F)
                            Tenant.dress(Sports-Slip_1_F, Cute-Flare-TShirt_1_F)
                            Tenant.dress(Sports-Slip_2_F, Cute-Flare-TShirt_1_F)
                        EndRandom
                    EndIf
                EndIf
            EndIf
            
            If sleeping==1
                Tenant.show(0,0,0)        // show up 
                Tenant.animate(na_sleep)
            ElseIf notInRoom==0
                Tenant.show()        // show up randomly
            EndIf
            
            // "DEBUG: <Tenant.Name>: arousal=<Tenant:arousal> rapport=<Tenant:rapportwithplayer> perversion=<Tenant:perversion> sub-maso=<Tenant:masochist>"
            
            // Show tenant B
            If TenantB.isValid()
                chance = Random(0,5)
                If TenantBClothingStyle == 1 || chance <=2
                    // Show up in underwear
                    If TenantB.isMale()
                        TenantB.dressExcept(Outerwear, Top, Bottom, Foot, Headwear)
                    Else
                        // dressExcept produces ugly results for girls in version 3.17 at least
                        Random
                            TenantB.dress(Cool-Bra_1_F,Cool-Panties_1_F)
                            TenantB.dress(Cool-Bra_1_F,Cool-Panties_2_F)
                            TenantB.dress(Cool-Bra_1_F,Appealing-Panties_1_F)
                            TenantB.dress(Cool-Bra_1_F,Appealing-Panties_2_F)
                            TenantB.dress(Cool-Bra_1_F,Appealing-Panties_3_F)
                            TenantB.dress(Cool-Bra_1_F,Appealing-Panties_4_F)
                            TenantB.dress(Cool-Bra_2_F,Cool-Panties_1_F)
                            TenantB.dress(Cool-Bra_2_F,Cool-Panties_2_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_1_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_1_F,Stockings_2_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_2_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_2_F,Stockings_2_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_3_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_3_F,Stockings_2_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_4_F)
                            TenantB.dress(Cool-Bra_2_F,Appealing-Panties_4_F,Stockings_2_F)
                            TenantB.dress(Cool-Bra_3_F,Cool-Panties_1_F)
                            TenantB.dress(Cool-Bra_3_F,Cool-Panties_2_F)
                            TenantB.dress(Cool-Bra_3_F,Appealing-Panties_1_F)
                            TenantB.dress(Cool-Bra_3_F,Appealing-Panties_2_F)
                            TenantB.dress(Cool-Bra_3_F,Appealing-Panties_3_F)
                            TenantB.dress(Cool-Bra_3_F,Appealing-Panties_4_F)
                        EndRandom
                    EndIf
                ElseIf TenantBClothingStyle == 2
                    TenantB.strip()
                Else 
                    If TenantB.isMale()
                        TenantB.dress()
                    Else
                        // Dress some nice private room clothing
                        Random
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_1_F,Cute-Croptop_1_F)
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_2_F,Cute-Croptop_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Croptop_2_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_2_F,Cute-Croptop_2_F)
                            Tenant.dress(Cool-Bra_1_F,Cool-Panties_1_F,Cute-Cami-Top_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Cami-Top_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_1_F,Cute-Cami-Top_1_F,Cute-Leggings_1_F)
                            Tenant.dress(Cool-Bra_2_F,Cool-Panties_2_F,Cute-Croptop_2_F,Cute-Leggings_1_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_1_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_2_F)
                            Tenant.dress(Sports-Slip_1_F, Sports-Bra_3_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_1_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_2_F)
                            Tenant.dress(Sports-Slip_2_F, Sports-Bra_3_F)
                            Tenant.dress(Sports-Bodysuit_1_F)
                            Tenant.dress(Sports-Slip_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_2_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_1_F, Nice-Camisole_1_F)
                            Tenant.dress(Cool-Panties_2_F,Nice-Camisole_1_F,Cute-Flare-Skirt_1_F)
                            Tenant.dress(Cool-Panties_1_F,Cute-Flare-TShirt_1_F,Cute-Flare-Skirt_1_F)
                            Tenant.dress(Sports-Slip_1_F, Cute-Flare-TShirt_1_F)
                            Tenant.dress(Sports-Slip_2_F, Cute-Flare-TShirt_1_F)
                        EndRandom
                    EndIf
                EndIf
                TenantB.show()        // show up randomly
                // "DEBUG: SECOND <TenantB.Name>: arousal=<TenantB:arousal> rapport=<TenantB:rapportwithplayer> perversion=<TenantB:perversion> sub-maso=<TenantB:masochist>"
            EndIf
            
            If viewMode==1  // KeyHole
                //TODO: cameraLock()
                cameraMove(42,18,600)
                cameraFocus(0,0,0)
            ElseIf viewMode==2  // camera
                //TODO: cameraLock()
                cameraMove(-40,-40,1800)
                cameraFocus(42,18,0)
            EndIf
                
            chance = Random(0,10)
            If sleeping == 1
                cameraFocus(Tenant)
                "<Tenant.Name> is sleeping."
                Player:arousal += Random(0,0.25)
            ElseIf notInRoom>0
                "The room is empty."
            ElseIf sleeping==0 && chance <= 3
                cameraFocus(Tenant)
                If TenantB.isValid() && Tenant.isInterestedIn(TenantB) && TenantB.isInterestedIn(Tenant)
                    Tenant.strip()
                    TenantB.strip()
                    "Oh wow! <Tenant.Name> and <TenantB.Name> are having fun together!"
                    sex(Tenant, TenantB)
                    passTime(0.25,1)
                Else
                    Tenant.strip()
                    "Mhh, <Tenant.Name> is about to have a good time in there..."
                    sex(Tenant)
                    passTime(0.25,1)
                EndIf
                Player:arousal += Random(5,10)
            ElseIf viewMode == 1 && chance >=7
                "<Tenant.Name> noticed something at the door. You try to run away..."
                SneakGame()
                If Random(0, 100) < sneak
                    "<Tenant.Name> did not notice you!"
                Else
                    Random
                        Tenant(Angry)::"Hey <Player.Name>! Have you been trying to peek on me?!"
                        Tenant(Angry)::"<Player.Name> what are you doing at my door? Trying to peek in?"
                        Tenant(Angry)::"<Player.Name>, what the fuck?! Did you try to peek on me?"
                        Tenant(Angry)::"Ey <Player.Name>, you did not try to peek trough the key hole right?"
                        Tenant(Angry)::"What are you doing here <Player.Name>? Trying to peek trough the key?"
                    EndRandom
                    Tenant:rapportwithplayer-=Random(0,2)
                    
                    "Oops... You were caught. Try to get a spy cam or get better in sneaking..."
                Endif
            Else
                "Nothing exciting going on in there..."
            EndIf
            
            Tenant.hide()
            If TenantB.isValid()
                TenantB.hide()
            EndIf
            Player.show()
            
            // Reset the cam
            cameraMove(0,0,800)
            
            passTime(0.25,0.5)
        EndIf //  viewMode>0
        
        SceneEnd()
    EndIf
    
    // eof