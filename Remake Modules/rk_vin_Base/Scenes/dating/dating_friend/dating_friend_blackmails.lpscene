WHAT: all, -pickpocket, -go_to_the_bathroom, -sleep, -sleep_hotel, -nap, -nap_hotel, -rk_VB_small_sleep
WHERE: home
WHEN: 0 - 24
WHO: Dating = getSpecific(Dating); Affair = getSpecific(Affair); Actor = getSpecific(Dating_Friend); If Actor:rapportwithplayer < 10 && Actor.isInterestedIn(Player) && Actor:perversion > 50 && random(0, 100) < Actor:intelligence - intelligence
OTHER: isAtDatingHome()
    
    SceneStart()
    
        Hunger = Player.getActorVar(rk_VB_Hunger)
        HungerEnable = rk_VB_EnableHunger.getGlobal()
        MoneyBribing = random(200, 1000)
        MoneyBribing_loc = MoneyBribing.convertToLocalCurrency()
        "I heard a knock on the door. I wonder who it is."
        Actor.dress()
        Actor.show(2)
        
        "It's <Actor.name>, my <Dating.boyfriend_or_girlfriend> <Dating.name>'s friend. <Actor.He_or_She> must be looking for <Dating.name>."
        Player(Sad):: "Oh, it's you, <Actor.name>. What a shame though, <Dating.name> just went out and won't be back for another few hours."
        Actor(Happy):: "Yes, I know. <Dating.He_or_She> told me. However, that's exactly why I'm here. I'm here for you!"
        Player(Surprised):: "Oh really? Come inside then."
        "<Actor.name> came inside and sat down in the living room. This is certainly unusual. What on earth does <Actor.he_or_she> want to talk to me about?"
        Player(Anxious):: "So, <Actor.name>, what do you want to talk to me about? You're acting quite mysterious ..."
        
        Actor(Evil):: "I'll keep it short then: I know all about your little affair with <Affair.name>. And it's going to cost you if you want to keep my mouth shut in front of <Dating.name>."
        0:: money >= MoneyBribing:: "Bribe"
        1:: perversion > 10:: "Offer sex"
        2:: "Stay firm"
        
        If 0
        
            Player(Sad):: "Alright, you got me. How much do you want?"
            Actor(Evil):: "Give me <MoneyBribing_loc>, and I will shut my mouth!"
            Player(Sad)::"Damn, alright, I have no choice, here's your money..."
            Actor(Evil):: "Thank you. That should be enough to shut my mouth."
            money -= MoneyBribing
            mood -= 30
        ElseIf 1
            Player(Flirty):: "Maybe I can keep your mouth shut if I give you some of the same treatments that <Affair.name> got?"
            
            If Actor.isInterestedIn(Player) && arousal > 25 && perversion > 50
                Actor(Flirty):: "How could I say no?"
                mood -= 5
                Sex(Player, Actor)
                If HungerEnable > 0
                    Player.modifyActorVar(rk_VB_Hunger, -2)
                EndIf
            Else
                HalfBribing = random(200, 500)
                MoneyBribing2 = MoneyBribing + HalfBribing
                MoneyBribing2_loc = MoneyBribing2.convertToLocalCurrency()
                Actor(Angry):: "Don't try to escape, give me <MoneyBribing2_loc>, and I will shut my mouth!"

                If money < MoneyBribing2
                    Player(Sad)::"Finally, I thought I had money, but no, so ok, I have no choice, let's fuck!"
                    mood -= 5
                    Actor(Evil):: "You see...Good <Player.boy_or_girl>!"
                    Sex(Player, Actor)
                    mood -= 5
                    If HungerEnable > 0
                        Player.modifyActorVar(rk_VB_Hunger, -2)
                    EndIf
                Else
                    Player(Sad)::"Damn, alright, I have no choice, here's your money..."
                    Actor(Evil):: "Thank you. That should be enough to shut my mouth."
                    money -= MoneyBribing2
                    mood -= 30
                EndIf
            EndIf
        Else
        
            Player(Angry):: "Go ahead and tell <Dating.him_or_her> then. We'll see who <Dating.he_or_she> will believe: <Dating.his_or_her> <Player.boyfriend_or_girlfriend> or a random friend."
            Actor(Angry):: "As you wish then!"
            Actor.hide()
            "<Actor.name> stormed off, swearing that <Actor.he_or_she> would tell <Dating.name> everything ..."
            // Do I beat is ass if I win scene end
            "A few hours later ..."
            Dating.dress()
            Dating.show(2)
            Dating(Angry):: "<Actor.name> called me! <Actor.He_or_She> told me everything about your affair. What do you have to say for yourself?"      
            0:: "Deny"
            1:: "Confess and apologize"
            2:: masochist < 0:: "Admit unreservedly"
    
            If 0
            
                Player(Angry):: "Baby! You must trust me. Don't believe those baseless rumours. Your friend tried to sleep with me but I stayed faithful to you so <Actor.he_or_she> is now trying to sabotage our relationship in revenge. <Affair.name> and I - we didn't do anything!"
                If intelligence - Dating:intelligence > Random (0, 50)
                    Dating(Sad):: "Maybe you're right. I'm sorry - I shouldn't have believed those lies from <Actor.name>. In fact, <Actor.he_or_she> will no longer be my friend ..."
                    Dating:masochist += 1
                    mood += 0.5
                    breakup = false
                    Actor.removeDatingFriend()
                Else
                    Dating(Furious):: "You still want to continue lying to me? Do you take me for a fool?"
                    Dating:masochist -= 1
                    mood -= 2
                    breakup = true
                EndIf
                
            ElseIf 1
            
                Player(Crying):: "Baby! It was a terrible mistake. I didn't mean to hurt you. I have felt guilty about it everyday since ... Please don't leave me - it will never happen again."
                If Dating:attractiontoplayer + interpersonal > random(0, 200)
                    Dating(Sad):: "... Fine. For everything we've done together, I might as well give you one final chance. I hope I won't regret this later."
                    Dating:masochist += 1
                    mood += 0.5
                    breakup = false
                Else
                    Dating(Furious):: "Of course you would say that. They always say it's a mistake. You know what? I made a mistake getting in a relationship with someone like you in the first place."
                    Dating:masochist -= 1
                    mood -= 2
                    breakup = true      
                EndIf
                
            Else
            
                Player(Evil):: "It's about time you find out ... So I fucked <Affair.him_or_her>. What's the matter? So what are you going to do? Break up with me? As if a loser like you could find someone better!"
                masochist -= random(0, 2)
                If Dating:masochist > random(30, 100)
                    Dating(Shocked):: "How could you? I'm your <Dating.boyfriend_or_girlfriend> ... But I guess you're right ... I couldn't bear to break up with you."
                    Dating:masochist += random(0, 10)
                    mood += 2
                    breakup = false
                Else
                    Dating(Furious):: "Now I get to see your true colours! Are you not at least a bit sorry? Yes, I'm indeed breaking up with you. Get the fuck out of my life."
                    breakup = true
                EndIf
                
            EndIf
            death = false
            If breakup
                If Dating:masochist + karma < -50
                    Dating.animate(gun)
                    Dating.moveToPerson(Player)
                    Dating(Furious):: "You betrayed me, you humiliated me ... now you die!"
                    Bitchfired = 0
                    While Bitchfired < 3
                        If Bitchfired > 0
                            Dating(Angry)::"YOU WILL DIE MOTHERFUCKER!"
                        EndIf
                        "Pow!"
                        Player.hide()
                        "<Dating.name> fired <Dating.his_or_her> gun..."
                        If random(0, 30) < fitness
                            "I managed to dodge the shot. Phew, that was close."
                            Player(Shocked)::"Are you fucking crazy?"
                            sneak += 1
                            mood += 1
                            Bitchfired += 1
                            If HungerEnable > 0
                                Player.modifyActorVar(rk_VB_Hunger, -2)
                            EndIf
                        
                        ElseIf Bitchfired >= 3
                            
                            "I managed to escape the house. Phew, that was close."
                            setBackground(street)
                            Player.animate(call)
                            "And I already call the cops who arrest <Dating.him_or_her> right away!"
                            mood += 5
                            sneak += 1
                            Dating.setDatingId()
                            loseDating()
                            Player.animate()
                            If isPlayerMarried()
                                "And just like that, I demand divorced to <Dating.name>... <Dating.He_or_She> have no choice to say ye, anyway!"
                                mood -= 50
                                Divorce()
                                If Dating.isDominantSex(Player)
                                    "To make matters worse to <Dating.him_or_her>, the court awarded me for compensation, half of <Dating.his_or_her> hard-earned fortune..."
                                    money += random(5000, 50000)
                                EndIf
                            Else
                        
                                "After that crazy event, I take time to block <Dating.name>'s number ..."
                                mood -= 50
                            EndIf
                            ActID = Dating.getID()
                            Dating.setActorVar(rk_VB_ActArrestTagF, ActID)
                            Dating.setActorVar(tag_FPrison, 1)
                            Friendsentence = random(925, 1825)
                            Dating.setActorVar(rk_VB_Sentence, Friendsentence)
                            Dating.setActorVar(rk_VB_MeToF, ActID)
                            DayGetImprison = Dating:age
                            Dating.setActorVar(rk_VB_ActSentence, DayGetImprison)
                        
                            If HungerEnable > 0
                                Player.modifyActorVar(rk_VB_Hunger, -10)
                            EndIf
                        Else
                            Dating.setDatingId()
                            Player.hide()
                            "<Dating.name> managed to shot me in the chest. It was a perfect shot ..."
                            loseDating()
                            Divorce()
                            followUp(death)
                            death = true
                        EndIf
                    EndWhile
                ElseIf isPlayerMarried()
                    Dating(Sad):: "I'm afraid this marriage isn't working ..."
                    "And just like that, <Dating.name> divorced me ..."
                    Dating.setDatingId()
                    mood -= 100
                    Divorce()
                    loseDating()
                    If Player.isDominantSex(Dating) && money > 1000
                        "To make matters worse, the court awarded half of my hard-earned fortune to <Dating.name> ... What a disaster of a marriage that was ..."
                        money -= money*0.5
                    EndIf
                    
                Else
                    "And just like that, <Dating.name> broke up with me ... What's more - I found out later that <Dating.he_or_she> also blocked my number."
                    Dating.setDatingId()
                    loseDating()
                    mood -= 50
                EndIf
                blockContact(Dating)
                
            ElseIf Affair.isContactExchanged() && Dating:masochist < 30
                Dating(Angry):: "I can forgive you, with one condition ..."
                Dating(Angry):: "You must end all contacts with <Affair.name> - no meeting, call, social media, the rest of it!"
                0:: "Block <Affair.name>"
                1:: "No"
                
                If 0
                    Player(Sad):: "I guess I don't have another choice ..."
                    blockContact(Affair)
                Else
                    Player(Sad):: "I'm afraid I can't do that ... <Affair.name> is an important person in my life."
                    Dating(Furious):: "More important than your own <Dating.boyfriend_or_girlfriend> apparently ... Fine, then it's over between us!"
                    If isPlayerMarried()
                        Dating(Sad):: "I'm afraid this marriage isn't working ..."
                        "And just like that, <Dating.name> divorced me ..."
                        mood -= 100
                        Dating.setDatingId()
                        Divorce()
                        loseDating()
                        If Player.isDominantSex(Dating) && money > 1000
                            "To make matters worse, the court awarded half of my hard-earned fortune to <Dating.name> ... What a disaster of a marriage that was ..."
                            money -= money*0.5
                        EndIf        
                    Else
                        Dating.setDatingId()
                        "And just like that, <Dating.name> broke up with me ... What's more - I found out later that <Dating.he_or_she> also blocked my number."
                        loseDating()
                        mood -= 50
                    EndIf
                    blockContact(Dating)
                EndIf
            EndIf
    
            Dating.hide()
    
            If !death
                
                If Dating.isDating()
                    forgiveAffairs()
                    
                    If Affair.isContactExchanged()
                        "Phew ... that was a relief. <Dating.He_or_She> didn't break up with me even after what happened."
                        If perversion > 50
                            "Suddenly, a perverted and evil idea came to mind: I could celebrate by calling <Affair.name> over and continuing to get away with the affair!"
                            0:: "Call <Affair.name> over"
                            1:: "I should not"
                            
                            If 0
                                
                                karma -= 5
                                perversion += random(0,1)
                                masochist -= random(0,2)
                                "A while later ..."
                                Affair.dress()
                                Affair.show(2)
                                Affair(Evil):: "Hah, what a dumb of a <Dating.boyfriend_or_girlfriend> you have! I would love to see <Dating.his_or_her> face if <Dating.he_or_she> knew that you went off to me right away after the loser forgave you ..."
                                Sex(Affair, Player)
                                If HungerEnable > 0
                                    Player.modifyActorVar(rk_VB_Hunger, -2)
                                EndIf
                                Affair.hide()
                                "I enjoyed that much more than usual. Maybe it was the blatant shamelessness of cheating on my <Dating.boyfriend_or_girlfriend> that added spices to the sex."
                                mood += 1
                                
                            Else
                            
                                "That's fucked up. I shouldn't play with my chances like that ... It's best if I avoid seeing <Affair.name> for a while at least."
                                mood -= 3
                            
                            EndIf
                        EndIf
                    EndIf
                ElseIf perversion > 30 && Affair.isContactExchanged()
                    "Now that it's all over, a perverted idea came to my mind: Should I call <Affair.name> over to ... cheer me up?"
                    0:: "Call <Affair.name> over"
                    1:: "I should not"
                    
                    If 0
                        karma -= 5
                        "I'll show that fool <Dating.name> that it's all <Dating.his_or_her> loss!"
                        "A while later ..."
                        Affair.dress()
                        Affair.show(2)
                        Affair(Evil):: "Hah, what a loser of a <Dating.boyfriend_or_girlfriend> you had - good riddance! I would love to see <Dating.his_or_her> face if <Dating.he_or_she> knew that you went off to me right away after the <Dating.idiot_or_bitch> broke up with you ..."
                        Sex(Affair, Player)
                        If HungerEnable > 0
                            Player.modifyActorVar(rk_VB_Hunger, -2)
                        EndIf
                        Affair.hide()
                        "I enjoyed that much more than usual. Sweet revenge certainly added spices to the sex."
                        perversion += random(0,1)
                        masochist -= random(0,2)
                        mood += 3
                    Else
                        "That would be an evil thing to do and an insult to my memories with <Dating.name>. I may have cheated but I'm not completely shameless ..."
                        karma -= 1
                    EndIf
                EndIf

            EndIf
        EndIf
    SceneEnd()  // Scene improved by Raddeck
    timeout(500, dating_friend_blackmails)